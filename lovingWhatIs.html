<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<title>Examining your thoughts</title>

<script>
console.log("Script begins");

// Code and text Copyright Kevin Verre (author of code and text)

// Inspired by the ideas of Byron Katie, author of "Loving What Is"

// Array of steps. Each step contains a question for the user
// Each step also contains how to handle the user's response
var steps =
[
	{
		"id": "welcome",
		"prompt": "Welcome! I will ask you some helpful questions.",
		"hint": "These questions are designed to help you worry less about something in your life, and to motivate you.<br/>Please submit anything to continue. (Press Enter or Click Button to submit)",
		"response": "",
		"response_handler": "handle_initial_response",
		"result_tag": ""
	},
	{
		"id": "noun",
		"prompt": "What is the noun (person, thing, or event) that is causing you stress?",
		"hint": "Examples: 'My boss', 'My roommate', 'My girlfriend', 'My project', 'My chore', 'My future', 'My career'",
		"response": "",
		"response_handler": "save_noun_response",
		"result_tag": "Thing bothering you"
	},
	{
		"id": "feel",
		"prompt": "How do you FEEL when you think about whatever is troubling you? How does '#{NOUN}' make you feel? ",
		"hint": "Examples: Hopeless, intimidated, frustrated, angry, scared, unmotivated, uninterested, unpset",
		"response": "",
		"response_handler": "save_feeling_response",
		"result_tag": "Feeling"
	},
	{
		"id": "thought",
		"prompt": "Write a thought about '#{NOUN}' and how you feel about it. ('#{FEELING}')",
		"hint": "Examples: My work is intimidating, My girlfriend is frustrating, Doing laundry is boring, My future is horrible, Learning that skill is too hard",
		"response": "",
		"response_handler": "save_thought_response",
		"result_tag": "Stressful thought"
	},
	{
		"id": "true",
		"prompt": "'#{THOUGHT}' ...Is it true?",
		"hint": "Be honest! It's OK to say Yes if you feel it is true to you right now. It doesn't matter if you say Yes or No.",
		"response": "",
		"response_handler": "",
		"result_tag": "True"
	},
	{
		"id": "absolutely",
		"prompt": "'#{THOUGHT}' ...Can you absolutely be sure it is true?",
		"hint": "Again, say Yes if it is true right now.",
		"response": "",
		"response_handler": "",
		"result_tag": "Absolutely true"
	},
	{
		"id": "react",
		"prompt": "How do you react when you think or believe '#{THOUGHT}'?",
		"hint": "Examples: I get scared, I procrastinate, I wish..., I avoid dealing with it or thinking about it",
		"response": "",
		"response_handler": "",
		"result_tag": "Reaction"
	},
	{
		"id": "without",
		"prompt": "Who would you be without the thought '#{THOUGHT}'? How would you react?",
		"hint": "",
		"response": "",
		"response_handler": "",
		"result_tag": "Without"
	},
		{
		"id": "treat",
		"prompt": "How do you treat '#{NOUN}' when you think '#{THOUGHT}'?",
		"hint": "",
		"response": "",
		"response_handler": "",
		"result_tag": "Behavior"
	},
	{
		"id": "envision",
		"prompt": "What do you see, envision, or imagine when you believe '#{THOUGHT}'?",
		"hint": "",
		"response": "",
		"response_handler": "",
		"result_tag": "Envision"
	},
	{
		"id": "envision_without",
		"prompt": "What do you see or imagine it would be like if you could let go of the thought '#{THOUGHT}'?",
		"hint": "",
		"response": "",
		"response_handler": "",
		"result_tag": "Envision without"
	},
	{
		"id": "drop",
		"prompt": "Can you see a reason to drop the thought '#{THOUGHT}'?",
		"hint": "",
		"response": "",
		"response_handler": "",
		"result_tag": "Can I see a reason to drop the thought"
	},
	{
		"id": "turnaround",
		"prompt": "What are some of the turnarounds? (for '#{THOUGHT}')",
		"hint": "A turn around is where you rephrase the thought toward yourself or towards the opposite in a way that you believe is more true",
		"response": "",
		"response_handler": "",
		"result_tag": "Turnarounds"
	},
	/*{
		"id": "false",
		"prompt": "What are THREE REASONS why '#{THOUGHT}' is false?",
		"hint": "",
		"response": "",
		"response_handler": "",
		"result_tag": "Arguments against the thought"
	}, 
	{
		"id": "myself",
		"prompt": "What are THREE WAYS in which I am somehow causing the feeling '#{FEELING}' to occur? Or how do your thoughts cause you to feel that way?",
		"hint": "",
		"response": "",
		"response_handler": "",
		"result_tag": "Turn around towards self"
	}, */
	{
		"id": "advice",
		"prompt": "What advice would you give yourself regarding '#{NOUN}'?",
		"hint": "",
		"response": "",
		"response_handler": "",
		"result_tag": "Advice for myself"
	}, 
	{
		"id": "now",
		"prompt": "How do you feel now?",
		"hint": "",
		"response": "",
		"response_handler": "",
		"result_tag": "Feeling now"
	},
	{
		"id": "end",
		"prompt": "The End",
		"hint": "Hope this thinking exercise helped you feel better. ",
		"response":"",
		"response_handler": "",
		"result_tag": ""
	}
];

// The most important user response's are saved here
var response = {
	"noun": "",
	"feeling": "",
	"thought": ""
};

function prep_string(string_in){
	// Only replaces the first occurance in the string

	// if the string has #{THOUGHT} replace it with the user's thought
	string_out = string_in.replace("#{THOUGHT}", response.thought);
	// if the string has #{FEELING} replace it with the user's feeling
	string_out = string_out.replace("#{FEELING}", response.feeling);

	// if the string has #{NOUN} replace it with the user's noun
	string_out = string_out.replace("#{NOUN}", response.noun);

	return string_out;
}

function save_noun_response(){
	user_response = $('#response_textarea').val().trim();
	if (user_response == ''){
		user_response = '#NOUN';
	}
	//remove punctuation
	user_response = user_response.replace(/[\.!]$/,'')
	response.noun = user_response;
	steps[current_step_number].response = user_response;
}
function save_feeling_response(){
	user_response = $('#response_textarea').val().trim();
	if (user_response == ''){
		user_response = '#FEELING';
	}
	user_response = user_response.replace(/[\.!]$/,'')

	response.feeling = user_response;
	steps[current_step_number].response = user_response;
}
function save_thought_response(){
	user_response = $('#response_textarea').val().trim();
	if (user_response == ''){
		user_response = '#THOUGHT';
	}
	user_response = user_response.replace(/[\.!]$/,'')

	response.thought = user_response;
	steps[current_step_number].response = user_response;
}

function handle_initial_response(){
	$('#response_textarea').show();
}


next_question_flag = false;

function display_step(step, current_step_number){
	// display an empty input
	$('#response_textarea').val('').focus();
	// display the prompt
	prepped_prompt = prep_string(step.prompt);
	$('#prompt_text').text(prepped_prompt);
	// display the hint
	prepped_hint = prep_string(step.hint);
	$('#hint_text').html(prepped_hint);
	//update question number
	number_str = ""+(current_step_number+1)+"/"+total_number_steps;
	$('#question_number_holder').html(number_str);

	// Print results so far to screen
	var results_area = $('#results_area');
	results_area.html('');

	for (var i = 0; i <= current_step_number; i++){
		temp_step = steps[i];
		if (temp_step.result_tag != "") {
			result_string = "<dt class=\"text-right\">" + temp_step.result_tag + ":</dt><dd class=\"text-left\">" + temp_step.response + "</dd>";
			results_area.append(result_string)
		}
	}

	if (current_step_number == 0) {
		$('#responses_headline').hide();
	} else {
		$('#responses_headline').show();
	}
}

// debug function
function print_step_results(step, step_number){

	result_string = "";
	// print the step number
	result_string += "" + step_number + ")";
	// print the step prompt
	prepped_prompt = prep_string(step.prompt);
	result_string += prepped_prompt;
	// print the step's hint
	// print the step's response

	console.log(result_string);
	console.log(step.response);
}

// main, run the program

// Go through all of the steps
var current_step_number = 0;
var total_number_steps = steps.length;

// INITIALIZE function
function display_first_question(){
	$('#response_textarea').hide(); // attach Enter key handler and hide, it starts out hidden

	var current_step_number = 0;
	first_step = steps[0];
	display_step(first_step, 0);
	$('#submit_button').focus();
	$('#response_textarea').on('keypress', enter_key_handler);
	$('#response_textarea').on('keyup', textarea_keyup);
	$('body').on('keyup', keyup_backarrow_key_handler);


	//$('#submit_button').on('click', test_submit_button_click_handler);

}

function release_next_question_flag(){
	next_question_flag = false;
}

function print_all_results(){ // debug function
	var x = 0;
	while (x < total_number_steps){
		print_step_results(steps[x],x);
		x++;
	}
}

function cleanup(){
	// hide the submit button
	$('#submit_button').hide();
	// hide the input textarea
	$('#response_textarea').hide();
}

function restart(){
	location.reload();
}

function textarea_keyup(e){
	if (e.keyCode == 13){
		release_next_question_flag();
	}
}

function enter_key_handler(e){
	// when enter is pressed in text area we should submit the form
	if (e.keyCode == 13){
		//make sure Shift key is not also pressed
		if (e.shiftKey){
			return;
		}

		e.preventDefault();
		e.stopPropagation();
		submit_response_handler();
		return false;
	}
}

// a.k.a. Next question function 
function submit_response_handler(){
	if (next_question_flag) {
		// do nothing. We can't go to the next question yet
		return;
	}
	next_question_flag = true;

	// Save the user's response
	cur_step = steps[current_step_number];
	user_response = $('#response_textarea').val().trim();
	cur_step.response = user_response;

	// execute that step's unique response handler
	if (cur_step.response_handler != ""){
		name_of_function = cur_step.response_handler;
		window[name_of_function]();
	}

	// Go to the next step
	current_step_number += 1;

	next_step = steps[current_step_number];
	display_step(next_step, current_step_number);

	// Check to see if we are done
	if (current_step_number == total_number_steps){
		print_all_results();
		console.log('The end!');
		cleanup();
		return;
	}
}

function test_submit_button_click_handler(e)
{
	console.log("test_submit_button_click_handler function entered");
	submit_response_handler();
}

function submit_button_click_handler(e)
{
	console.log("submit_button_click_handler function entered");
	submit_response_handler();
	release_next_question_flag();
}

function previous_question(e){
	if (current_step_number <= 0){
		return; // do nothing
	}
	current_step_number -= 1;
	step_to_display = steps[current_step_number];
	step_to_display.response = '';
	display_step(step_to_display, current_step_number);
}

function keyup_backarrow_key_handler(e){
	if (e.keyCode == 37){
		previous_question(e);
	} else if (e.keyCode == 39) {
		submit_response_handler();
		release_next_question_flag();
	}
}

</script>
</head>
<body onload="display_first_question();">

<div class="jumbotron" style="background-color: #ffe0e5;">
	<div class="container">
		<div class="row">
			<div>
				<div id="prompt_text" class="text-left h2">Hello!</div>
			</div>
		</div>
		<div class="row">
			<div id="hint_text" class="text-left h4">Here's a hint: The Javascript wasn't executed correctly.</div>
		</div>

		<div class="row">
			<textarea id="response_textarea" style="width:50%;"></textarea>
		</div>
		
		<div class="row">
			<input id="submit_button" type="button" value="Next/Submit response" onclick="submit_button_click_handler();" class="btn btn-primary"/>
		</div>
		<div class="row">
		<div>Step <div id="question_number_holder" style="display:inline-block;">1/14</div></div>
		</div>
		<div class="row">
			<div id="responses_headline" class="text h4 bold">Responses:</div>
			<dl id="results_area" class="dl-horizontal"></dl>
		</div>
		<div class="row">
			<input id="previous_button" type="button" value="Previous question" class="btn-xs" onclick="previous_question();" />
		</div>
	</div>
</div>

<hr/>
<div class="container">
	<div class="row"><input type="button" value="Restart" onclick="restart();" class="btn-danger btn-xs"/></div>
	<div class="row"><div class="text-small small"><em>Your answers are private and are not saved anywhere.</em></div></div>
	<div class="row"><div class="text-small small">Website code and text by Kevin Verre.</div></div>
	<div class="row"><div class="text-small small">
		Questions inspired by book "Loving What Is" and the "Love Your Neighbor" worksheet by Byron Katie. (<a href="thework.com">thework.com</a>)</div>
	</div>
	<div class="row text-small small"><a href="http://thework.com/sites/thework/downloads/worksheets/JudgeYourNeighbor_Worksheet.pdf">Link to Byron Katie's worksheet</a></div>
</div>
<hr/>
<div class="container">
	<br/>
	<div class="row text-left text-small small">
		<p>MORE INFO:</p>

		<p>I answers these questions whenever I'm feeling worried, nervous, frustrated, lazy, or unmotivated about something.</p>

		<p>Answer the questions HONESTLY. Don't give an answer just because you think it's the "right" answer or the answer you think you SHOULD give. Give the answer that truely reflects what you're thinking and feeling.</p>

		<p>The purpose is not necessarily to change your feelings about the issue, but to change your action. For example, if there is something you're angry about, the goal is not necessarily to make you stop being completely frustrated about it. But hopefully it will inspire you to take productive action. Same for if you have something you are procrastinating on. You might not become excited about your chore, but you'll at least stop procrastinating and start doing it.</p>

		<p>These questions should get your brain thinking in a way that it wasn't before.</p>

		<p>This tool is designed to hopefully be quick and easy to use. After using it enough, you can answer the questions very quickly. You don't even have to answer all the questions. Sometimes I stop after answering the question about "Who would you be WITHOUT the thought/belief?"</p>

		<p>All of the code for this site runs in your browser. You can see the source code by right-clicking and selecting View Source.</p>
	</div>
</div>

</body>
</html>




